## 网络

#### TCP四次挥手

TCP四次挥手的TIME-WAIT状态是在第4次挥手时，也就是客户端向服务器端发送了连接释放确认报文之后。
TIME-WAIT状态需要等待2MSL(最长报文段时间)时间，原因是：
1、**保证服务器在第三次挥手之后能收到第四次挥手的报文**。假设客户端不等待2MSL而是在发送了第四次挥手报文后直接关闭，可能由于网络的原因服务器收不到第四次挥手的报文，这样服务器就没办法关闭这个TCP连接。现在客户端第四次挥手后等待2MSL，假设还是因为网络原因服务器收不到第四次挥手的报文，服务器就会超时重传第三次挥手的报文，客户端接着也会再发送一次第四次挥手的报文，这样可以保证服务器收到了第四次挥手的报文，保证TCP连接正常关闭。
2、等待两个2MSL，可以**保证此次TCP连接内的报文都从网络上消失**，保证关闭连接后不会再有滞留在网络中的报文去骚扰服务器。

#### TCP 流量控制原理

TCP 流量控制就是让发送方不要发送太快，好让接受方来的急处理，因为接受方的缓存大小是有限的。
TCP报文的首部有一个窗口字段，窗口字段的作用就是用于说明允许对方发送的最多数据量。
在发送方和接受方通信过程中，接受方通过TCP报文中的窗口字段告诉发送方自己最多还可以接受多少数据，这就是**接受窗口**，同时发送方还根据当前网络情况估计一个**拥塞窗口**。发送方的**发送窗口**取接受窗口和拥塞窗口的最小值。这样就可以保证接受方的缓存不会溢出。

#### TCP 保证可靠数据传输使用到的机制

1、序号。TCP首部的序号字段用来保证数据能够有序的发送到对方。
2、确认。
3、重传。
4、校验和。

#### TCP 拥塞控制

1、慢启动
2、拥塞避免
3、快恢复
4、快重传

#### UDP如何实现可靠数据传输

可以在应用层加入类似于TCP的确认机制、重传机制、窗口机制来实现可靠数据传输。

#### 输入一个url经历了什么

[参考](https://cloud.tencent.com/developer/article/1396399)

1. TCP 三次握手 四次挥手

   三次握手：客户端发送**连接请求**报文，SYN=1，seq=x（随机初始化的），连接请求报文不携带任何数据，但是需要消耗掉一个序号；服务器接收到连接请求报文后，给客户端发送**连接确认报文**，SYN=1，ACK=1，seq=y（服务器端随机初始化），ack=x+1，连接确认报文不携带任何数据，仍然需要消耗点一个序号。客户端再次给服务器端发送报文，SYN=0，ACK=1，seq=x+1，ack=y+1，这个报文段可以携带数据，不携带数据就不消耗序号。

   为什么需要第三次握手？

   假设没有第三次握手，客户端首先发送一个连接请求报文，由于网络原因，这个报文阻塞在网络中，到达不了服务器，超时后客户端再次发送一个连接请求报文，服务器收到连接请求报文后发送连接确认报文，这时连接建立，服务器与客户端进行通信，通信结束后释放连接。这时第一次发送的连接请求报文又到达了服务器端，这样客户端与服务器端的连接又建立啦，但是客户端并不需要与服务器端进行通信，这样就导致服务器等待客户端发送数据，客户端确根本不会发送数据，白白浪费了资源。

   四次挥手：首先释放掉客户端到服务器端的连接。客户端发送报文，FIN=1，seq=x，这个报文不携带数据，但是仍然需要消耗掉一个序号，服务器端发送连接释放确认报文，ACK=1，seq=y，ack=x+1，这样从客户端到服务器端的TCP连接就释放掉啦，客户端不可以再向服务器端发送数据啦，但是依然要接受服务器端发送来的数据。这时**服务器端**进入了**CLOSE_WAIT状态**。服务器端在收到这个报文后进入关闭状态。

   如果将来的某个时刻，服务器也要释放TCP连接，服务器向客户端发送连接释放报文，FIN=1，seq=u，ack=x+1，ACK=1这个报文仍然需要消耗掉一个序号，客户端接收到这个报文后，再向服务器端发送一个报文，ACK=1，seq=x+1，ack=u+1，然后客户端**进入TIME_WAIT状态**，这时连接并没释放，客户端还需要等待**两个最长报文段时间**之后才释放。

   为什么需要等待**两个最长报文段时间**？

   - 保证客户端发送的第四次挥手的报文段能够到达服务器端。第四次挥手的报文段可能丢失在网络中，这样服务器端就不能正确的关闭TCP连接。如果等待两个最长报文段时间的话，服务端在接收不到第四挥手的报文段后它还可以重传第三次挥手的报文段，这样客户端就可以在两个最长报文段时间内再重传一次第四次挥手的报文段。这样整个TCP连接就可以正常释放掉。
   - 等待两个最长报文段时间，可以保证整个TCP连接的报文都消失在网络中，而不会影响其他的TCP连接。

2. 滑动窗口介绍，有什么用

   滑动窗口的作用是进行流量控制，因为接收方的缓存的大小是有限制的，如果发送方毫不顾忌的发送数据，接收方可能处理不过来，缓存会溢出。流量控制就是，让发送方不要发送太快，让接收方来来得及接收。

   滑动窗口，在发送端，发送端的窗口由3个指针将数据分为4种，分别是：**已经发送并收到确认报文的**、**已经发送但是还未收到确认报文的**、**可以发送但是还未发送**、**不可发送的数据**。当发送端收到接收端的确认报文后，发送端会根据**确认报文中的窗口字段和确认号调整发送窗口**，原来不可发送的数据这时可能就变得可以发送啦。

   拥塞避免，是为了在网络出现拥塞时避免过多的报文发送到网络，加重网络的负担。**慢开始**、**拥塞避免**

   快重传：**当出现3次冗余ACK时，就直接重传对方未接收到的报文，不用等到报文超时。**

   快恢复：**当出现3次冗余ACK时，将慢开始门限设置为当前拥塞窗口的一半，再将拥塞窗口减半，开始执行拥塞避免算法。**

   1. http和https的区别

   http用的是**80**端口，https用的是**443端**口。https比http多了一个SSl层协议，SSL是安全套接字协议。

   如何保证客户端收到的公钥是正确的？

   当服务器想使用HTTPS时，就需要向第三方机构进行认证服务器的公钥，第三方机构会将服务器的公钥和证书放在一块。当服务器端向客户端发送证书后，客户端需要使用第三方的公钥验证证书的正确性，如果验证通过，就说明证书中的公钥是可以信赖的，取出来证书中的公钥；否则，就是不可以信赖的。这里用来验证第三方证书正确性的公钥是事先内置在浏览器中的。